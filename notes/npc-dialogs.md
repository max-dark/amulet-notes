# Диалоги с NPC

Некоторые NPC имеют возможность общения с игроком.
Определяется по наличию файла `speak/$npsId`

## Формат файла диалога `speak/$npsId`

```php
<?php
return [
    'begin'   => 'title 0#answer 1#nextId1#answer 2#nextId2',
    'nextID1' => 'title 1#answer 3#begin#answer 4#nextID2',
    'nextID2' => 'title 2',
];
```

* Файл диалога - php файл с ассоциативным массивом.
* Ключи массива - ID темы.
* начальная тема - `begin`
* Значения содержат реплику NPC и варианты ответов пользователя.

По принципу работы очень похоже на "State machine"

## Формат элемента диалога

* тип: строка
* Разделитель полей: `#`
* Элемент диалога состоит из:
    * ID элемента
    * title - заголовка(реплики NPC)
    * списка вариантов ответов(элемент без списка ответов завершает диалог)

Варианты ответа состоят из реплики пользователя и следующего ID в диалоге - ответа NPC.

Реплики, начинающиеся с `eval:` - php-скрипты и обрабатываются через функцию `eval`.

Такие вставки мешают изменению во всем коде, так как:
* содержат обращение к глобальным переменным
* много "Copy-Paste"
* их трудно изменять.

Подстроки `<name>` заменяются на имя персонажа пользователя.

## Другое

TODO: описать диаолги изменения статов, изучения умений и торговли.