# Логика работы game/index.php

1. получить переменные из запроса
2. если запрос пуст (либо пусты `SID` и `site`),
    1. то установить переход на форму входа(`site = 'main'`)
3. получить из `SID` логин и пароль пользователя
4. загрузить(либо создать) `data/game.dat` и установить переменную `game`
5. если игра на обслуживании,
    1. то вывести сообщение и завершить работу
6. если установлена страница перехода
    1. то вывести ее
        * `main` - форма входа. Так же служит для задания логина нового пользователя
        * `stat` - ссылки на  статистику
        * `flag` - инфо о флаге
        * `castle` - замки и их владельцы
        * `clans` - кланы и их участники
        * `faq` - ответы на частые вопросы
        * `news` - новости
        * `online` - список пользователей "в игре"
        * `connect`/`connect2` - довольно запутанный механизм входа, нужно упростить
        * `gamereg` - форма ввода информации о новом игроке(логин задается в `main`)
        * `reg2` - проверка данных из `gamereg` и добавление игрока в БД
    2. выйти.
7. произвести зачистку тех, кто по времени ушел в оффлайн.
8. если пользователя выкинуло,
    1. то отправить на страницу входа.
9. проверить пароль пользователя
10. загрузить пользовательские настройки отображения
11. если установлена переменная `ctele`, то телепорт к замку(нужно уточнить)
12. если установлена переменная `stele`, то телепорт к супругу(нужно уточнить)
13. загрузить текущую и соседние локации и если требуется, то произвести в них обновление
14. загрузить персонажа пользователя
15. проверить команды в следующем порядке(выполнение команды в основном завершает скрипт)
    1. `ce` - сохранение и выход
    2. `cm` - макросы
    3. `adm` - админка
    4. `speak`, `cs` - говорить/взять. для предметов - переход к `take`
    5. `take` - взять предмет // для записок и книг переходим к команде `look`
    6. `say` - сказать в чат
    7. `ca` - атаковать
    8. `drop` - выбросить
    9. `use` - использовать предмет/умение // для записок и книг переходим к команде `look`
    10. `look`, `ci` - осмотреть/информация
    11. `msg` - почта
    12. `trade` - торговля/обмен
    13. `list`, `cl` - управление списками предметов, умений и тд
    14. `map` - показать карту
16. если команда не задана либо вернула управление,
    1. то вывести основной экран игры